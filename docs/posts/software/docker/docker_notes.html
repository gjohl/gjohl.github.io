<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Gurpreet Johl">
<meta name="dcterms.date" content="2025-05-25">
<meta name="description" content="Docker? I Hardly Know ’Er">

<title>Gurpreet Johl - Docker</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Gurpreet Johl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../blog.html"> 
<span class="menu-text">Notes</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/gjohl"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/gurpreetjohl"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/gurpreetjohl"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Docker</h1>
                  <div>
        <div class="description">
          Docker? I Hardly Know ’Er
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Software</div>
                <div class="quarto-category">Engineering</div>
                <div class="quarto-category">DataEngineering</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Gurpreet Johl </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 25, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#docker-overview" id="toc-docker-overview" class="nav-link active" data-scroll-target="#docker-overview">1. Docker Overview</a>
  <ul class="collapse">
  <li><a href="#what-is-docker" id="toc-what-is-docker" class="nav-link" data-scroll-target="#what-is-docker">1.1. What is Docker?</a></li>
  <li><a href="#why-use-containers" id="toc-why-use-containers" class="nav-link" data-scroll-target="#why-use-containers">1.2. Why Use Containers?</a></li>
  <li><a href="#virtual-machines-vs-docker-containers" id="toc-virtual-machines-vs-docker-containers" class="nav-link" data-scroll-target="#virtual-machines-vs-docker-containers">1.3. Virtual Machines vs Docker Containers</a></li>
  <li><a href="#docker-setup" id="toc-docker-setup" class="nav-link" data-scroll-target="#docker-setup">1.4. Docker Setup</a></li>
  <li><a href="#overview-of-a-container" id="toc-overview-of-a-container" class="nav-link" data-scroll-target="#overview-of-a-container">1.5. Overview of a Container</a></li>
  </ul></li>
  <li><a href="#images-and-containers" id="toc-images-and-containers" class="nav-link" data-scroll-target="#images-and-containers">2. Images and Containers</a>
  <ul class="collapse">
  <li><a href="#image-vs-container" id="toc-image-vs-container" class="nav-link" data-scroll-target="#image-vs-container">2.1. Image vs Container</a></li>
  <li><a href="#using-prebuilt-images" id="toc-using-prebuilt-images" class="nav-link" data-scroll-target="#using-prebuilt-images">2.2. Using Prebuilt Images</a></li>
  <li><a href="#building-our-own-image" id="toc-building-our-own-image" class="nav-link" data-scroll-target="#building-our-own-image">2.3. Building Our Own Image</a></li>
  <li><a href="#running-a-container-based-on-our-image" id="toc-running-a-container-based-on-our-image" class="nav-link" data-scroll-target="#running-a-container-based-on-our-image">2.4. Running a Container Based On Our Image</a></li>
  <li><a href="#images-are-read-only" id="toc-images-are-read-only" class="nav-link" data-scroll-target="#images-are-read-only">2.5. Images Are Read-Only</a></li>
  <li><a href="#understanding-image-layers" id="toc-understanding-image-layers" class="nav-link" data-scroll-target="#understanding-image-layers">2.6. Understanding Image Layers</a></li>
  <li><a href="#managing-images-and-containers" id="toc-managing-images-and-containers" class="nav-link" data-scroll-target="#managing-images-and-containers">2.7. Managing Images and Containers</a></li>
  <li><a href="#stopping-and-restarting-containers" id="toc-stopping-and-restarting-containers" class="nav-link" data-scroll-target="#stopping-and-restarting-containers">2.8. Stopping and Restarting Containers</a></li>
  <li><a href="#attached-and-detached-containers" id="toc-attached-and-detached-containers" class="nav-link" data-scroll-target="#attached-and-detached-containers">2.9. Attached and Detached Containers</a></li>
  <li><a href="#interactive-mode" id="toc-interactive-mode" class="nav-link" data-scroll-target="#interactive-mode">2.10 Interactive Mode</a></li>
  <li><a href="#deleting-containers" id="toc-deleting-containers" class="nav-link" data-scroll-target="#deleting-containers">2.11. Deleting Containers</a></li>
  <li><a href="#deleting-images" id="toc-deleting-images" class="nav-link" data-scroll-target="#deleting-images">2.12 Deleting Images</a></li>
  <li><a href="#inspecting-images" id="toc-inspecting-images" class="nav-link" data-scroll-target="#inspecting-images">2.12 Inspecting Images</a></li>
  <li><a href="#copying-files-into-and-from-a-running-container" id="toc-copying-files-into-and-from-a-running-container" class="nav-link" data-scroll-target="#copying-files-into-and-from-a-running-container">2.13 Copying Files Into and From a Running Container</a></li>
  <li><a href="#names-and-tags" id="toc-names-and-tags" class="nav-link" data-scroll-target="#names-and-tags">2.14. Names and Tags</a></li>
  <li><a href="#sharing-images" id="toc-sharing-images" class="nav-link" data-scroll-target="#sharing-images">2.15. Sharing Images</a>
  <ul class="collapse">
  <li><a href="#registries" id="toc-registries" class="nav-link" data-scroll-target="#registries">2.15.1. Registries</a></li>
  <li><a href="#push" id="toc-push" class="nav-link" data-scroll-target="#push">2.15.2. Push</a></li>
  <li><a href="#pull" id="toc-pull" class="nav-link" data-scroll-target="#pull">2.15.3. Pull</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">2.16. Summary</a></li>
  </ul></li>
  <li><a href="#managing-data-in-containers" id="toc-managing-data-in-containers" class="nav-link" data-scroll-target="#managing-data-in-containers">3. Managing Data in Containers</a>
  <ul class="collapse">
  <li><a href="#different-categories-of-data" id="toc-different-categories-of-data" class="nav-link" data-scroll-target="#different-categories-of-data">3.1. Different Categories of Data</a></li>
  <li><a href="#volumes" id="toc-volumes" class="nav-link" data-scroll-target="#volumes">3.2. Volumes</a></li>
  <li><a href="#how-to-add-a-volume" id="toc-how-to-add-a-volume" class="nav-link" data-scroll-target="#how-to-add-a-volume">3.3. How to Add a Volume</a></li>
  <li><a href="#types-of-external-data-storage" id="toc-types-of-external-data-storage" class="nav-link" data-scroll-target="#types-of-external-data-storage">3.4. Types of External Data Storage</a>
  <ul class="collapse">
  <li><a href="#volumes-1" id="toc-volumes-1" class="nav-link" data-scroll-target="#volumes-1">3.4.1. Volumes</a></li>
  <li><a href="#bind-mounts" id="toc-bind-mounts" class="nav-link" data-scroll-target="#bind-mounts">3.4.2 Bind Mounts</a></li>
  </ul></li>
  <li><a href="#combining-and-merging-different-volumes" id="toc-combining-and-merging-different-volumes" class="nav-link" data-scroll-target="#combining-and-merging-different-volumes">3.5. Combining and Merging Different Volumes</a></li>
  <li><a href="#restarting-web-servers" id="toc-restarting-web-servers" class="nav-link" data-scroll-target="#restarting-web-servers">3.6. Restarting Web Servers</a></li>
  <li><a href="#read-only-volumes" id="toc-read-only-volumes" class="nav-link" data-scroll-target="#read-only-volumes">3.7. Read-Only Volumes</a></li>
  <li><a href="#managing-docker-volumes" id="toc-managing-docker-volumes" class="nav-link" data-scroll-target="#managing-docker-volumes">3.8. Managing Docker Volumes</a></li>
  <li><a href="#dockerignore-file" id="toc-dockerignore-file" class="nav-link" data-scroll-target="#dockerignore-file">3.9. dockerignore file</a></li>
  </ul></li>
  <li><a href="#arguments-and-environment-variables" id="toc-arguments-and-environment-variables" class="nav-link" data-scroll-target="#arguments-and-environment-variables">4. Arguments and Environment Variables</a>
  <ul class="collapse">
  <li><a href="#environment-variables" id="toc-environment-variables" class="nav-link" data-scroll-target="#environment-variables">4.1. Environment Variables</a></li>
  <li><a href="#arguments" id="toc-arguments" class="nav-link" data-scroll-target="#arguments">4.2. Arguments</a></li>
  </ul></li>
  <li><a href="#networking" id="toc-networking" class="nav-link" data-scroll-target="#networking">5. Networking</a>
  <ul class="collapse">
  <li><a href="#types-of-communication" id="toc-types-of-communication" class="nav-link" data-scroll-target="#types-of-communication">5.1. Types of Communication</a>
  <ul class="collapse">
  <li><a href="#container-to-web-communication" id="toc-container-to-web-communication" class="nav-link" data-scroll-target="#container-to-web-communication">5.1.1. Container to Web Communication</a></li>
  <li><a href="#container-to-host-machine-communication" id="toc-container-to-host-machine-communication" class="nav-link" data-scroll-target="#container-to-host-machine-communication">5.1.2. Container to Host Machine Communication</a></li>
  <li><a href="#container-to-container-communication" id="toc-container-to-container-communication" class="nav-link" data-scroll-target="#container-to-container-communication">5.1.3. Container to Container Communication</a></li>
  </ul></li>
  <li><a href="#docker-container-networks" id="toc-docker-container-networks" class="nav-link" data-scroll-target="#docker-container-networks">5.2. Docker Container Networks</a></li>
  <li><a href="#network-drivers" id="toc-network-drivers" class="nav-link" data-scroll-target="#network-drivers">5.3. Network Drivers</a></li>
  <li><a href="#how-docker-resolves-ip-addresses" id="toc-how-docker-resolves-ip-addresses" class="nav-link" data-scroll-target="#how-docker-resolves-ip-addresses">5.4. How Docker Resolves IP Addresses</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="docker-overview" class="level1">
<h1>1. Docker Overview</h1>
<section id="what-is-docker" class="level2">
<h2 class="anchored" data-anchor-id="what-is-docker">1.1. What is Docker?</h2>
<p>Docker is a tool for <strong>creating and managing containers</strong>.</p>
<p>A container is a <strong>standardised unit of software</strong> - a package of code and the dependencies required to run the code. The same container always yields the exact same application and execution behaviour.</p>
<p>Support for containers is built into all modern operating systems. Docker simplifies the creation and management of containers. Containers are a general idea, Docker is just the de facto standard tool for dealing with containers.</p>
</section>
<section id="why-use-containers" class="level2">
<h2 class="anchored" data-anchor-id="why-use-containers">1.2. Why Use Containers?</h2>
<p>Why would we want independent, standardised, standalone applications packages?</p>
<ul>
<li>We may have different dev vs prod environments. We want to build and test in the same way.</li>
<li>Multiple developers keeping their development environments in sync with each other.</li>
<li>Clashing tools and versions between projects.</li>
</ul>
</section>
<section id="virtual-machines-vs-docker-containers" class="level2">
<h2 class="anchored" data-anchor-id="virtual-machines-vs-docker-containers">1.3. Virtual Machines vs Docker Containers</h2>
<p>With a virtual machine (VM), we have:</p>
<ul>
<li>Our operating system</li>
<li>A VM with virtual OS</li>
<li>Libraries and dependencies</li>
<li>Our own app</li>
</ul>
<p>This does allow separated environments which environment-specific configurations which can be shared and reproduced. However, it involves a lot of duplication, can be slow with long boot times and reproducing on another server is possible but can be tricky.</p>
<p>There is a big overhead with VMs, because we recreate <strong>everything</strong> including the (virtual) OS every time we want a new VM. This wastes a lot of storage and tends to be slow.</p>
<p>A container is a lightweight solution to the same problem. The Docker Engine interfaces with the OS, and the container sits on top of the Docker engine. This means each container only needs to contain its own code + data, it doesn’t need to reproduce the OS or any additional utlities.</p>
<ul>
<li>OS</li>
<li>OS built-in container support</li>
<li>Docker engine</li>
<li>Container - App, libraries</li>
</ul>
<p>The benefits of a container compared to a VM:</p>
<ul>
<li>Low impact on OS, minimal storage usage</li>
<li>Sharing and rebuilding is easy</li>
<li>Encapsulate apps and environments rather than whole machines</li>
</ul>
</section>
<section id="docker-setup" class="level2">
<h2 class="anchored" data-anchor-id="docker-setup">1.4. Docker Setup</h2>
<p>The specific steps depend on the OS, so check the <a href="https://docs.docker.com/get-started/">docs</a>.</p>
<p>For Linux, install Docker Engine. For Mac and Windows, install Docker Desktop (or Docker Toolbox if requirements not met).</p>
<p><a href="https://labs.play-with-docker.com/">Docker playground</a> is helpful to try things out in a browser with no installation required.</p>
<p><a href="https://hub.docker.com/">Docker Hub</a> (my second favourite <code>*hub.com</code> on the internet*) is a centralised repository that lets us share containers.</p>
<p>Docker compose and Kubernetes help manage multi-container apps.</p>
<p>* <em>Number one is <strong>git</strong>hub, you dirty dog.</em></p>
</section>
<section id="overview-of-a-container" class="level2">
<h2 class="anchored" data-anchor-id="overview-of-a-container">1.5. Overview of a Container</h2>
<p>The <code>Dockerfile</code> file (no extension) contains the list of commands to create our image.</p>
<p>To <strong>build</strong> the container run this in a terminal in the same directory as the Dockerfile:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build .</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To <strong>run</strong> the container:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="op">&lt;</span>image_id<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Optionally, if we want to <strong>expose</strong> port 3000 inside the container to the outside world, run:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-p</span> 3000:3000 <span class="op">&lt;</span>image_id<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Some other useful basic commands are <strong>listing</strong> running containers:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> ps <span class="at">-a</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And <strong>stopping</strong> a container:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> stop <span class="op">&lt;</span>container_name<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="images-and-containers" class="level1">
<h1>2. Images and Containers</h1>
<p>Docker image and container <a href="Cheat-Sheet-Images-Containers.pdf">cheat sheet</a>.</p>
<section id="image-vs-container" class="level2">
<h2 class="anchored" data-anchor-id="image-vs-container">2.1. Image vs Container</h2>
<p>A <strong>container</strong> is a running “unit of software”. An <strong>image</strong> is the blueprint for the container.</p>
<p>So we can define an image then create containers running in multiple places. The image contains the <em>code and environment</em>, the container is the <em>running app</em>.</p>
</section>
<section id="using-prebuilt-images" class="level2">
<h2 class="anchored" data-anchor-id="using-prebuilt-images">2.2. Using Prebuilt Images</h2>
<p>We can either use a prebuilt image or one that we’ve created ourselves.</p>
<p>Docker Hub is useful for finding and sharing prebuilt images.</p>
<p>To <strong>run a prebuilt image</strong> from docker hub, <code>node</code> in this case, run this in a terminal:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run node</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This will automatically <code>pull</code> the prebuilt node image if it hasn’t already been pulled, then run it.</p>
<p>By default, the container is isolated, but we can run it in <strong>interactive mode</strong> if we want to use the REPL.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> node</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can use <code>exec</code> to interact with the shell terminal of an <em>already running container</em>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> exec <span class="at">-it</span> <span class="op">&lt;</span>container_name<span class="op">&gt;</span> sh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="building-our-own-image" class="level2">
<h2 class="anchored" data-anchor-id="building-our-own-image">2.3. Building Our Own Image</h2>
<p>We can build our own images; typically these will layer on top of other prebuilt images. The <code>Dockerfile</code> file configures the image.</p>
<p>We typically start with <code>FROM</code> to build on some base image, either on your local system or on DockerHub.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode dockerfile code-with-copy"><code class="sourceCode dockerfile"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> node</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We then want to tell Docker which files on the local machine should go in the image. Often we want to <code>COPY</code> the contents of the current directory to the container file system, for example in a directory called app.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode dockerfile code-with-copy"><code class="sourceCode dockerfile"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> . /app</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>WORKDIR</code> command tells docker that any subsequent commands we <code>RUN</code> should run from this directory. So instead of the above copy with absolute filepath, we could do:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode dockerfile code-with-copy"><code class="sourceCode dockerfile"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">COPY</span> . .</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We then want to <code>RUN</code> a command inside the image, for example, to install dependencies.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode dockerfile code-with-copy"><code class="sourceCode dockerfile"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">npm</span> install</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The command instruction, <code>CMD</code>, specifies code to execute when the <strong>container</strong> is started. Contrast this with <strong>image</strong>** is created. An example of the distinction is starting a server, which we do in the container. The syntax is a bit odd, instead of <code>CMD node server.js</code> we need to pass the command as an array of strings.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode dockerfile code-with-copy"><code class="sourceCode dockerfile"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CMD</span> [“node”, “server.js”]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you don’t specify a <code>CMD</code>, the <code>CMD</code> of the base image will be executed. It should be the <strong>last</strong> instruction in a Dockerfile.</p>
<p>The web server listens on a particular port, say port 80. The container is isolated, so we need to <code>EXPOSE</code> the port.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode dockerfile code-with-copy"><code class="sourceCode dockerfile"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">EXPOSE</span> 80</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This is best practice to <em>explicitly declare any used ports</em>, but it is <strong>optional</strong> and does not actually make the port available. For this, we need to specify the port with the <code>-p</code> flag when creating the container with <code>docker run</code>. See the next section.</p>
</section>
<section id="running-a-container-based-on-our-image" class="level2">
<h2 class="anchored" data-anchor-id="running-a-container-based-on-our-image">2.4. Running a Container Based On Our Image</h2>
<p>We have a complete Dockerfile, next we need to <code>build</code> the image. In a terminal in the same directory as the <code>Dockerfile</code>, run:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build .</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This outputs an <strong>image ID</strong>. We can then <code>run</code> this image. This blocks the terminal.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="op">&lt;</span>image_id<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We need the “publish” <code>-p</code> flag to make the port in the container accessible. Say we want to access the application through a local port 3000, and we are accessing the internal port 80 inside the container.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-p</span> 3000:80 <span class="op">&lt;</span>image_id<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can then see our app if we visit <code>localhost:3000</code> in a browser.</p>
</section>
<section id="images-are-read-only" class="level2">
<h2 class="anchored" data-anchor-id="images-are-read-only">2.5. Images Are Read-Only</h2>
<p>If we are changing the code inside the image, we need to <em>build the image again</em> and then <em>run a new container</em> from the new image.</p>
<p>The contents of an image are set at the build step and cannot be altered afterwards.</p>
</section>
<section id="understanding-image-layers" class="level2">
<h2 class="anchored" data-anchor-id="understanding-image-layers">2.6. Understanding Image Layers</h2>
<p>Images are <strong>layer-based</strong>. This means that if there is a change to the image and the image is rebuilt, it will cache previous layers and if the layer is unchanged, it will use the cached layer. It will <em>only recreate layers where there was a change</em> (and all subsequent layers).</p>
<p>This means we can optimise our Dockerfile by copying code which changes frequently near the end, and code which is relatively static, like dependencies, should go earlier. So when we have a code change, we don’t need to reinstall everything.</p>
</section>
<section id="managing-images-and-containers" class="level2">
<h2 class="anchored" data-anchor-id="managing-images-and-containers">2.7. Managing Images and Containers</h2>
<p>The following commands are useful when managing images and containers.</p>
<p>Images:</p>
<ul>
<li>Tag: <code>-t</code></li>
<li>List: <code>docker images</code></li>
<li>Analyse: <code>docker image inspect &lt;image_id&gt;</code></li>
<li>Remove: <code>docker rmi  &lt;image_id&gt;</code>; <code>docker prune</code></li>
</ul>
<p>Containers:</p>
<ul>
<li>Name: <code>-—name</code></li>
<li>List: <code>docker ps</code></li>
<li>Remove: <code>docker rm</code></li>
</ul>
</section>
<section id="stopping-and-restarting-containers" class="level2">
<h2 class="anchored" data-anchor-id="stopping-and-restarting-containers">2.8. Stopping and Restarting Containers</h2>
<p>Start a new container with <code>docker run</code>.</p>
<p>If nothing in our image has changed, we may just want to restart a previously run container:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> start <span class="op">&lt;</span>container_name<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="attached-and-detached-containers" class="level2">
<h2 class="anchored" data-anchor-id="attached-and-detached-containers">2.9. Attached and Detached Containers</h2>
<p>An <strong>attached</strong> container is running and blocks the terminal. For example, when we use <code>docker run</code>. Attached simply means we are “listening” to the output of the container, which can be helpful if we want to look at the logs.</p>
<p>A <strong>detached</strong> container is running but runs in the background without blocking the terminal. For example, when we run <code>docker start</code>.</p>
<p>We can configure whether to run in attached or detached mode. The <code>-d</code> flag runs in detached mode:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="op">&lt;</span>image_id<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>-a</code> flag runs in attached mode:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> start <span class="at">-a</span> <span class="op">&lt;</span>container_name<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can attach ourselves to a detached container using:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> attach <span class="op">&lt;</span>container_name<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To see the log history, we can use</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> logs <span class="op">&lt;</span>container_name<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can run this in “follow” mode with the <code>-f</code> flag to print the logs and keep listening (i.e.&nbsp;attach to the container)</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> logs <span class="at">-f</span> <span class="op">&lt;</span>container_name<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="interactive-mode" class="level2">
<h2 class="anchored" data-anchor-id="interactive-mode">2.10 Interactive Mode</h2>
<p>If we have an application that requires <strong>user input</strong>, or we just want to see what’s going on inside the container, we can run in interactive mode.</p>
<p>We do this with the interactive flag <code>-i</code>. This keeps STDIN open even if not attached. This is analogous to how the attach flag <code>-a</code> keeps STDOUT open.</p>
<p>We usually combine this with the TTY flag <code>-t</code>. This allocates a pseudo-TTY, which exposes a terminal we can use.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="op">&lt;</span>image_id<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="deleting-containers" class="level2">
<h2 class="anchored" data-anchor-id="deleting-containers">2.11. Deleting Containers</h2>
<p>We can list all containers with:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> ps</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can remove containers with:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> rm <span class="op">&lt;</span>container_name<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can pass multiple containers to remove separated by a space.</p>
<p>We can’t remove a running container, so we need to stop it first:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> stop <span class="op">&lt;</span>container_name<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can remove ALL stopped containers with</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> container prune</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="deleting-images" class="level2">
<h2 class="anchored" data-anchor-id="deleting-images">2.12 Deleting Images</h2>
<p>Analogously to containers, we can list images with:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> images </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We remove images with:</p>
<pre><code>docker rmi &lt;image_id&gt;</code></pre>
<p>We can pass multiple images to remove separated by a space.</p>
<p>We can’t remove images which are being used by containers, even if that container is stopped. The <em>container needs to be removed first</em> before the image can be removed.</p>
<p>We can remove all <em>unused</em> images with:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> image prune</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This will remove all <strong>untagged</strong> images. To also remove tagged images we need the <code>-a</code> flag</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> image prune <span class="at">-a</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can pass the <code>--rm</code> flag to the docker run command to automatically remove the container once stopped.</p>
</section>
<section id="inspecting-images" class="level2">
<h2 class="anchored" data-anchor-id="inspecting-images">2.12 Inspecting Images</h2>
<p>We can understand more about an image by inspecting it:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> image inspect <span class="op">&lt;</span>image_id<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This tells us:</p>
<ul>
<li>ID</li>
<li>Creation date</li>
<li>Config such as ports, entry point, interactive, etc</li>
<li>Docker version</li>
<li>OS</li>
<li>Layers</li>
</ul>
</section>
<section id="copying-files-into-and-from-a-running-container" class="level2">
<h2 class="anchored" data-anchor-id="copying-files-into-and-from-a-running-container">2.13 Copying Files Into and From a Running Container</h2>
<p>We can copy files in and out of a running container with the <code>cp</code> command.</p>
<p>To copy a file into a container:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> cp <span class="op">&lt;</span>source file or folder<span class="op">&gt;</span> <span class="op">&lt;</span>container_name<span class="op">&gt;</span>:/<span class="op">&lt;</span>path in container<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To copy out of a container, just swap the order of the arguments:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> cp <span class="op">&lt;</span>container_name<span class="op">&gt;</span>:/<span class="op">&lt;</span>path in container<span class="op">&gt;</span> <span class="op">&lt;</span>source file or folder<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This allows us to add config or data to a running container, or copy results or logs out of the container.</p>
</section>
<section id="names-and-tags" class="level2">
<h2 class="anchored" data-anchor-id="names-and-tags">2.14. Names and Tags</h2>
<p>We can add <code>--name</code> and <code>--tag</code> in the <code>docker run</code> command to specify our own name and tag for a container.</p>
<p>For images, when we execute docker build we can specify a tag with <code>--tag</code> or <code>-t</code>. Image tags consist of <code>name:tag</code> e.g.&nbsp;<code>python:3.11</code> or <code>node:latest</code>.</p>
</section>
<section id="sharing-images" class="level2">
<h2 class="anchored" data-anchor-id="sharing-images">2.15. Sharing Images</h2>
<section id="registries" class="level3">
<h3 class="anchored" data-anchor-id="registries">2.15.1. Registries</h3>
<p>Everyone who has an image can create a container from it; we are sharing images not containers.</p>
<p>We could share the source code and Dockerfile to allow somebody to build the image themselves.</p>
<p>Alternatively, we can just share the built image. No build is required and we don’t need to share the full source code.</p>
<p>We can share in:</p>
<ul>
<li>Docker Hub</li>
<li>Any private registry</li>
</ul>
</section>
<section id="push" class="level3">
<h3 class="anchored" data-anchor-id="push">2.15.2. Push</h3>
<p>We can <code>push</code> to and <code>pull</code> from the registry with the following commands. By default these refer to Docker Hub.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> push <span class="op">&lt;</span>image_name<span class="op">&gt;</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> pull <span class="op">&lt;</span>image_name<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We pass <code>host:name</code> rather than just an image name if we want to push or pull from a <strong>private</strong> registry.</p>
<p>Steps:</p>
<ol type="1">
<li>Create the image in Docker Hub.</li>
<li>Create an image on our local machine with the same image name.</li>
<li>Push with the <code>docker push</code> command above.</li>
</ol>
<p>We can re-tag an existing image with:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> tag <span class="op">&lt;</span>old_image_name<span class="op">&gt;</span> <span class="op">&lt;</span>new_image_name<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This <em>clones</em> the image; the old name still exists.</p>
<p>We need to <code>login</code> to be able to push to a docker hub repo:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> login </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can also <code>logout</code> with:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> logout</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="pull" class="level3">
<h3 class="anchored" data-anchor-id="pull">2.15.3. Pull</h3>
<div class="sourceCode" id="cb40"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> pull <span class="op">&lt;</span>image_name<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This will pull the latest version by default. You can specify a tag to override this.</p>
<p>We can execute <code>run</code> and it will automatically download the image if you don’t already have it locally. If you do have it locally, you might have an out of date version and docker run won’t tell you this.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="op">&lt;</span>image_name<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">2.16. Summary</h2>
<ul>
<li>Images (blueprints) vs Containers (the running instance of the app).</li>
<li>Images can be pulled or built.</li>
<li>The Dockerfile configures the image when building our own images.</li>
<li>Images are built in layers.</li>
<li>We can run containers from an image, and configure some helpful flags when running.</li>
<li>We can manage containers: list, remove, stop, start</li>
<li>We can manage images: list, remove, push, pull</li>
</ul>
</section>
</section>
<section id="managing-data-in-containers" class="level1">
<h1>3. Managing Data in Containers</h1>
<p>Docker volumes <a href="Cheat-Sheet-Data-Volumes.pdf">cheat sheet</a>.</p>
<section id="different-categories-of-data" class="level2">
<h2 class="anchored" data-anchor-id="different-categories-of-data">3.1. Different Categories of Data</h2>
<ul>
<li><strong>Application</strong>. Code and environment. Added to the image in the build phase. This is read-only and stored in <em>images</em>.</li>
<li><strong>Temporary application data</strong>. Fetched or produced by the container, e.g.&nbsp;data input by a user of a web server. Stored in memory or temporary files. Read and write, but only temporary, so stored in <em>containers</em>.</li>
<li><strong>Permanent application data</strong>. Fetched or produced in the running container, e.g.&nbsp;user account data. These are stored in files or a database which we want to persist even if the container stops or is removed. Read and write permanent data, so store in <em>volumes</em>.</li>
</ul>
<p>The container has its own file system, which is lost when the container is <strong>removed</strong> (not when the container is stopped). This means the <em>temporary data is lost</em> when the container is removed.</p>
<p>This is a problem as we need to rebuild the image and start a new container whenever we make a code change.</p>
<p>Volumes solve this problem.</p>
</section>
<section id="volumes" class="level2">
<h2 class="anchored" data-anchor-id="volumes">3.2. Volumes</h2>
<p>Volumes are folders on the <strong>host</strong> machines which are <em>mounted</em> (made available) into containers. A container can read and write to a volume.</p>
<p>The <code>COPY</code> command in a Dockerfile is just a one-time snapshot. A volume syncs the data between the two; if either the container or the host machine updates the data then it is reflected in the other.</p>
<p>This allows us to <strong>persist</strong> data if a container shuts down or is removed.</p>
</section>
<section id="how-to-add-a-volume" class="level2">
<h2 class="anchored" data-anchor-id="how-to-add-a-volume">3.3. How to Add a Volume</h2>
<p>The <code>VOLUME</code> instruction can be used in a <code>Dockerfile</code>. It takes an array of the path(s) inside the container to map to volumes.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="ex">VOLUME</span> [ “/app/feedback” ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that we do not specify a path on the host machine to map to. Docker abstracts this away from us; we never know the location on our host machine, we only interact with it via <code>docker volumes</code>. More on this later.</p>
</section>
<section id="types-of-external-data-storage" class="level2">
<h2 class="anchored" data-anchor-id="types-of-external-data-storage">3.4. Types of External Data Storage</h2>
<p>There are two types: volumes (managed by Docker) and bind mounts (managed by you).</p>
<section id="volumes-1" class="level3">
<h3 class="anchored" data-anchor-id="volumes-1">3.4.1. Volumes</h3>
<p>Volumes are managed by Docker. They can be <strong>anonymous</strong> or <strong>named</strong>.</p>
<p>In either case, Docker sets up a folder on your host machine in an unknown location which is accessed via the ‘docker volume’ command. This maps to the internal directory in the container.</p>
<p>Anonymous volumes are removed when the container is removed. This might not be very helpful for our use cases if we want to persist data.</p>
<p>This is where <em>named volumes</em> should be used. Named volumes <em>do</em> survive the container being removed. They are useful for data which should be persisted but which you don’t need to edit directly, as it can only be accessed via <code>docker volumes</code>.</p>
<p>We can’t create named volumes inside the docker image, it needs to be create when we run the container using the <code>-v</code> flag.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-v</span> <span class="op">&lt;</span>volume_name<span class="op">&gt;</span>:<span class="op">&lt;</span>path/in/container<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can delete volumes with:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> volume rm <span class="op">&lt;</span>volume_name<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Or</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> volume prune</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="bind-mounts" class="level3">
<h3 class="anchored" data-anchor-id="bind-mounts">3.4.2 Bind Mounts</h3>
<p>Bind mounts are managed by you, by defining a path on your host machine. They are good for persistent <strong>editable</strong> data.</p>
<p>We set the bind mount up when we run a <em>container</em>, not when we build an <em>image</em>. Wrap the path in quotes in case it path has special characters or spaces.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-v</span> “<span class="op">&lt;</span>absolute/path/on/host/machine<span class="op">&gt;</span>:<span class="op">&lt;</span>path/in/container<span class="op">&gt;</span>” </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can also use shortcuts to current working directory:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="ex">-v</span> <span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span>:/app</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You need to ensure docker has access to the folder you’re sharing. In the docker preferences UI, check <code>Resources-&gt;File Sharing</code> contains the folder (or parent folder) that you want to mount.</p>
</section>
</section>
<section id="combining-and-merging-different-volumes" class="level2">
<h2 class="anchored" data-anchor-id="combining-and-merging-different-volumes">3.5. Combining and Merging Different Volumes</h2>
<p>We can have: - Data copied in the image build step (with the <code>COPY</code> command) - Volumes - named and anonymous - Bind mounts</p>
<p>If two or more of these refer to the <strong>same path</strong> in the container, the one with the <strong>longer file path</strong> (more specific) wins.</p>
<p>This can be helpful when, for example, we want a node project with “hot reload”.</p>
<ol type="1">
<li>In the image build step, copy the repo and npm install the dependencies</li>
<li>When running the container, bind mount the repo with the host machine. BUT this would overwrite the node modules folder in the repo, undoing the npm install step and meaning we have no third party libraries.</li>
<li>Also mount an (anonymous) volume specifically for the node modules folder. Since this is a more specific file path, it takes priority and will not be overwritten by the bind mount.</li>
</ol>
<p>This is a fairly common pattern in a variety of use cases. Use anonymous volumes with a specific path to prevent that folder being overwritten.</p>
</section>
<section id="restarting-web-servers" class="level2">
<h2 class="anchored" data-anchor-id="restarting-web-servers">3.6. Restarting Web Servers</h2>
<p>If you make a change to server code and want to restart the web server, it might not be trivial to do so.</p>
<p>You can stop and restart the container. This at least saves the trouble of rebuilding.</p>
<p>Or in node, you can add the <code>nodemon</code> package as a dependency, which watches for changes to the server code and restarts the server when required.</p>
<p>There may be other similar approaches for other languages and use cases besides web servers, but this type of thing is something to be aware of.</p>
</section>
<section id="read-only-volumes" class="level2">
<h2 class="anchored" data-anchor-id="read-only-volumes">3.7. Read-Only Volumes</h2>
<p>By default, volumes are <em>read-write</em>. We may want to make a volume <strong>read-only</strong>, which we can do with an additional colon after the volume name. This applies to the folder and all sub-folders.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="ex">-v</span> “bind/mount/path:path/in/container:ro”</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If we want a specific subfolder to be writable, we can do a similar trick like we did with the anonymous volume, where we specify a second more specific volume that allows read/write access.</p>
</section>
<section id="managing-docker-volumes" class="level2">
<h2 class="anchored" data-anchor-id="managing-docker-volumes">3.8. Managing Docker Volumes</h2>
<p>Volumes can be <strong>listed</strong> with:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> volume ls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Bind mounts do not appear here, as they are self-managed.</p>
<p>You can also <strong>create</strong> a volume directly with</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> volume create <span class="op">&lt;</span>volume_name<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>See information on a volume, including the mount point where the data actually is stored on the host machine, with the <code>inspect</code> command:</p>
<pre><code>docker volume inspect </code></pre>
<p><strong>Remove</strong> volumes with:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> volume rm <span class="op">&lt;</span>volume_name<span class="op">&gt;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> volume prune</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="dockerignore-file" class="level2">
<h2 class="anchored" data-anchor-id="dockerignore-file">3.9. dockerignore file</h2>
<p>We can use a <code>.dockerignore</code> file to specify folders and files to ignore.</p>
<p>This is similar in principle to a <code>.gitignore</code> file.</p>
</section>
</section>
<section id="arguments-and-environment-variables" class="level1">
<h1>4. Arguments and Environment Variables</h1>
<p>Docker supports build-time arguments (<code>ARG</code>) and run-time environment variables (<code>ENV</code>).</p>
<p>You typically should put <code>ARG</code> and <code>ENV</code> in one of the <strong>later image layers</strong>, as they are likely to change which requires rebuilding all subsequent layers.</p>
<section id="environment-variables" class="level2">
<h2 class="anchored" data-anchor-id="environment-variables">4.1. Environment Variables</h2>
<p>Environment variables are <strong>variables that can be set in the Dockerfile or on docker run</strong>. They are available inside the Dockerfile <strong>and</strong> in application code.</p>
<p>Insider the Dockerfile:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode dockerfile code-with-copy"><code class="sourceCode dockerfile"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ENV</span> &lt;VARIABLE_NAME&gt; &lt;default value&gt;</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="kw">ENV</span> PORT 80</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="kw">EXPOSE</span> $PORT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>When we use environment variables in the Dockerfile, preface them with a <code>$</code> to indicate that they are variable names not literal names.</p>
<p>We can use them in code too. The syntax depends on the language. In node, for example, it is <code>process.env.PORT</code>.</p>
<p>Then when we run the container with an environment variable passed</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run —env PORT=8000</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If we have multiple environment variables, pass each with a <code>--env</code> or <code>-e</code> flag followed by the <code>key=value</code> pair.</p>
<p>We can create an <strong>environment file</strong> with all environment variables and values in. This is helpful if we have lots of variables to keep track of. Say we have a file called <code>.env</code>, we can pass this to docker run with:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--env-file</span> ./.env</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="arguments" class="level2">
<h2 class="anchored" data-anchor-id="arguments">4.2. Arguments</h2>
<p>Arguments are variables that can be passed to the <code>docker build</code> command to be used inside the Dockerfile. It is not accessible to CMD or any application code.</p>
<p>In the Dockerfile, declare arguments with <code>ARG</code>, then use them prefixed with a <code>$</code>:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode dockerfile code-with-copy"><code class="sourceCode dockerfile"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ARG</span> DEFAULT_PORT=80</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ENV</span> PORT $DEFAULT_PORT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To overwrite the argument value in the build command:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> build —build-arg DEFAULT_PORT=69</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="networking" class="level1">
<h1>5. Networking</h1>
<p>Docker networking <a href="Cheat-Sheet-Networks-Requests.pdf">cheat sheet</a>.</p>
<section id="types-of-communication" class="level2">
<h2 class="anchored" data-anchor-id="types-of-communication">5.1. Types of Communication</h2>
<p>We may want to communicate from our container to:</p>
<ul>
<li>Another container</li>
<li>An external service (such as a website)</li>
<li>Our host machine</li>
</ul>
<p>It is best practice to have a <strong>single responsibility per container</strong>. So if we have a web server and a database, those should be two separate containers that can communicate with each other, rather than one monolith container.</p>
<p>If we were to just lump everything in one container, that’s essentially the same as lumping everything into a VM, so we’ve lost the modularity benefit of Docker. We’d need to rebuild the image and run a new container whenever anything changes anywhere.</p>
<section id="container-to-web-communication" class="level3">
<h3 class="anchored" data-anchor-id="container-to-web-communication">5.1.1. Container to Web Communication</h3>
<p>Out of the box, this works from containers. You don’t need any special set up to be able to send requests to a web page or web API from the container.</p>
</section>
<section id="container-to-host-machine-communication" class="level3">
<h3 class="anchored" data-anchor-id="container-to-host-machine-communication">5.1.2. Container to Host Machine Communication</h3>
<p>Replace <code>localhost</code> with <code>host.docker.internal</code>.</p>
<p>This tells Docker that we are actually referring to the host machine, and Docker will replace this with the IP address of the host machine as seen from inside the container.</p>
<p>So we just need to change our code so that any endpoints that are pointing at <code>localhost</code> get “translated” by Docker.</p>
</section>
<section id="container-to-container-communication" class="level3">
<h3 class="anchored" data-anchor-id="container-to-container-communication">5.1.3. Container to Container Communication</h3>
<p>If we <code>inspect</code> the container we want to connect to, we can see its IP address under <code>NetworkSettings</code>.</p>
<p>We can replace <code>localhost</code> with the IP address of the container in our code with connects to it.</p>
<p>But this is cumbersome and impractical. We need to inspect the IP address of container B, change our code for application A so that it references this IP address, then rebuild image A before we can finally run container A.</p>
<p><strong>Container networks</strong> simplify this.</p>
</section>
</section>
<section id="docker-container-networks" class="level2">
<h2 class="anchored" data-anchor-id="docker-container-networks">5.2. Docker Container Networks</h2>
<p>We can run multiple containers in the same <code>network</code> with:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run —network <span class="op">&lt;</span>network_name<span class="op">&gt;</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>All containers within a network can communicate with each other and all IP addresses are automatically resolved.</p>
<p>We need to explicitly <strong>create the network</strong> before we can use it. Docker does not automatically do this. To create a network called my-network:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> network create my-network</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can <strong>list</strong> networks with:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> network ls</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To communicate with another container in the network, just replace <code>localhost</code> in the URL with the <strong>target container name</strong>. Docker will automatically translate the IP address.</p>
<p>We don’t need to publish a port (with the -<code>p</code> flag) if the only connections are between containers in the network. We only need to publish a port when we want to communicate with a container from <em>outside the network</em>, such as from our host machine.</p>
</section>
<section id="network-drivers" class="level2">
<h2 class="anchored" data-anchor-id="network-drivers">5.3. Network Drivers</h2>
<p>Docker supports different network drivers, which we can set with the <code>--driver</code> argument when creating the network.</p>
<p>The driver options are:</p>
<ul>
<li><code>bridge</code> - This lets containers find each other by name when in the same network. This is the default driver and most common use case.</li>
<li><code>host</code> - For standalone containers, isolation between container and host system is removed (i.e.&nbsp;they share localhost as a network).</li>
<li><code>overlay</code> - Multiple Docker daemons (i.e.&nbsp;Docker running on different machines) are able to connect with each other. Only works in “Swarm” mode which is a dated / almost deprecated way of connecting multiple containers.</li>
<li><code>macvlan</code>: You can set a custom MAC address to a container - this address can then be used for communication with that container.</li>
<li><code>none</code> - All networking is disabled.</li>
</ul>
<p>You can also install third party plugins to add other behaviours and functionality.</p>
</section>
<section id="how-docker-resolves-ip-addresses" class="level2">
<h2 class="anchored" data-anchor-id="how-docker-resolves-ip-addresses">5.4. How Docker Resolves IP Addresses</h2>
<p>We’ve seen that, depending on the type of networking, we can refer to any of the following in our source code, and Docker will translate this to the correct IP address:</p>
<pre><code>localhost
host.docker.internal
container-name</code></pre>
<p>Docker owns the entire environment in which it runs. When it sees an outgoing request with one of the “translatable” names, it will replace that placeholder in the URL with the relevant IP address.</p>
<p>The source code isn’t changed. The translation only happens for outbound requests from inside the container / network.</p>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<ul>
<li>“Docker &amp; Kubernetes: The Practical Guide” <a href="https://www.udemy.com/course/docker-kubernetes-the-practical-guide/">Udemy course</a></li>
</ul>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>